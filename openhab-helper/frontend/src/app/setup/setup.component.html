<div class="card">
  <div class="card-content">
    <div class="columns is-gapless is-vcentered is-mobile">
      <div class="column is-narrow title-icon">
        <app-svg-icon icon="link-2-outline"></app-svg-icon>
      </div>
      <div class="column">
        <h2>API-Einstellungen</h2>
      </div>
      <div class="column is-narrow">
        <div
          class="tag"
          [ngClass]="{
            'is-success': openhabService.authenticated(),
            'is-danger': !openhabService.authenticated()
          }">
          <app-svg-icon
            [icon]="
              openhabService.authenticated()
                ? 'checkmark-outline'
                : 'alert-circle-outline'
            "></app-svg-icon
          >{{
            openhabService.authenticated()
              ? 'Authentifiziert'
              : 'Unauthentifiziert'
          }}
        </div>
      </div>
    </div>
    <p class="block has-text-gray">
      Aktualisiere deinen API-Token, um weitere Konfigurationsmöglichkeiten für
      smartberry zu nutzen.
    </p>
    <form
      [formGroup]="apiTokenForm"
      (ngSubmit)="submitAPIToken()"
      [ngClass]="{
        'has-error': apiTokenForm.touched && !apiTokenForm.valid
      }">
      <div class="field has-addons">
        <div class="control is-expanded">
          <input
            class="input"
            formControlName="apiToken"
            type="text"
            placeholder="Dein API-Token" />
        </div>
        <div class="control">
          <button type="submit" class="button is-primary">Speichern</button>
        </div>
      </div>

      <fieldset [attr.disabled]="openhabService.authenticated() ? null : true">
        <div class="field">
          <div class="control">
            <button
              type="submit"
              (click)="openhabService.unregister()"
              class="button is-primary">
              API-Token löschen
            </button>
          </div>
        </div>
      </fieldset>

      <p
        class="help is-danger"
        *ngIf="
          apiTokenForm.touched &&
          apiTokenForm.controls['apiToken'].hasError('invalidToken')
        ">
        API-Key funktioniert nicht.
      </p>
      <p
        class="help is-danger"
        *ngIf="
          apiTokenForm.touched &&
          apiTokenForm.controls['apiToken'].hasError('required')
        ">
        API-Key ist notwendig.
      </p>
      <p
        class="help is-danger"
        *ngIf="apiTokenForm.controls['apiToken'].hasError('connection')">
        Keine Verbindung zur OpenHAB-Instanz.
      </p>
    </form>
  </div>
</div>
